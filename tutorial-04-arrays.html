<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link type="text/css" rel="stylesheet" href="ucode.css"><title>Tutorial: Working with Arrays</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="";baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol><symbol id="toc-icon" viewBox="0 0 460 460"><path d="M40 70a40 40 0 1 0 0 80 40 40 0 0 0 0-80zM40 190a40 40 0 1 0 0 80 40 40 0 0 0 0-80zM40 310a40 40 0 1 0 0 80 40 40 0 0 0 0-80zM430 80H145a30 30 0 0 0 0 60h285a30 30 0 0 0 0-60zM430 200H145a30 30 0 0 0 0 60h285a30 30 0 0 0 0-60zM430 320H145a30 30 0 0 0 0 60h285a30 30 0 0 0 0-60z"/></symbol></defs></svg></head><body data-theme="light"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">ucode Documentation</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="KaA85LdlHsGxxA-wrqimQ"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-01-usage.html">Usage</a></div><div class="sidebar-section-children"><a href="tutorial-02-syntax.html">Syntax</a></div><div class="sidebar-section-children"><a href="tutorial-03-memory.html">Memory Management</a></div><div class="sidebar-section-children"><a href="tutorial-04-arrays.html">Working with Arrays</a></div><div class="sidebar-section-children"><a href="tutorial-05-dictionaries.html">Working with Dictionaries</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="vaQEPYkoMxBighD_rEvKz"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-core.html">core</a></div><div class="sidebar-section-children"><a href="module-debug.html">debug</a></div><div class="sidebar-section-children"><a href="module-digest.html">digest</a></div><div class="sidebar-section-children"><a href="module-fs.html">fs</a></div><div class="sidebar-section-children"><a href="module-io.html">io</a></div><div class="sidebar-section-children"><a href="module-log.html">log</a></div><div class="sidebar-section-children"><a href="module-math.html">math</a></div><div class="sidebar-section-children"><a href="module-nl80211.html">nl80211</a></div><div class="sidebar-section-children"><a href="module-resolv.html">resolv</a></div><div class="sidebar-section-children"><a href="module-rtnl.html">rtnl</a></div><div class="sidebar-section-children"><a href="module-socket.html">socket</a></div><div class="sidebar-section-children"><a href="module-struct.html">struct</a></div><div class="sidebar-section-children"><a href="module-uci.html">uci</a></div><div class="sidebar-section-children"><a href="module-uloop.html">uloop</a></div><div class="sidebar-section-children"><a href="module-zlib.html">zlib</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"><div class="github-home navbar-item"><a id="" href="https://github.com/jow-/ucode" target="">GitHub Project Page</a></div></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#dark-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div><div class="navbar-right-item toc-item"><button class="icon-button toc" aria-label="open-table-of-contents"><svg><use xlink:href="#toc-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section><header><h2>Working with Arrays</h2></header><article><p>Arrays in ucode are ordered collections that can store any ucode value. Unlike many other scripting languages where arrays are implemented as hash tables or linked lists, ucode arrays are true arrays in memory. This implementation detail provides several distinctive characteristics that developers should understand when working with arrays in ucode.</p><h2 id="key-characteristics-of-ucode-arrays">Key Characteristics of Ucode Arrays</h2><h3 id="true-memory-arrays">True Memory Arrays</h3><p>Ucode arrays are implemented as true arrays in memory, which means:</p><ul><li>They offer fast random access to elements by index</li><li>They are stored contiguously in memory</li><li>Memory allocation expands as needed to accommodate the highest used index</li></ul><h3 id="sparse-array-behavior">Sparse Array Behavior</h3><p>Because ucode arrays are true arrays in memory:</p><ul><li>Memory is always allocated contiguously up to the highest used index</li><li>All positions (including unused ones) consume memory</li><li>&quot;Empty&quot; or unused positions contain <code>null</code> values</li><li>There is no special optimization for sparse arrays</li></ul><h3 id="negative-index-support">Negative Index Support</h3><p>Ucode arrays provide convenient negative indexing:</p><ul><li><code>-1</code> refers to the last element</li><li><code>-2</code> refers to the second-last element</li><li>And so on, allowing easy access to elements from the end of the array</li></ul><h3 id="type-flexibility">Type Flexibility</h3><p>Arrays in ucode can hold any ucode value type:</p><ul><li>Booleans, numbers (integers and doubles), strings</li><li>Objects and arrays (allowing nested arrays)</li><li>Functions and null values</li><li>No type restrictions between elements (unlike typed arrays in some languages)</li></ul><h2 id="core-array-functions">Core Array Functions</h2><h3 id="array-information-functions">Array Information Functions</h3><h4 id="%7B%40link-module%3Acore%23length%7Clength(x)%7D-%E2%86%92-%7Bnumber%7D"><a href="module-core.html#length">length(x)</a> → {number}</h4><p>Returns the number of elements in an array. This is one of the most fundamental array operations in ucode.</p><pre class="prettyprint source"><code>let fruits = [&quot;apple&quot;, &quot;banana&quot;, &quot;orange&quot;];
length(fruits); // 3

let sparse = [];
sparse[10] = &quot;value&quot;;
length(sparse); // 11 (includes empty slots)
</code></pre><p>For arrays, <code>length()</code> returns the highest index plus one, which means it includes empty slots in sparse arrays. If the input is not an array, string, or object, <code>length()</code> returns null.</p><h4 id="%7B%40link-module%3Acore%23index%7Cindex(arr_or_str%2C-needle)%7D-%E2%86%92-%7Bnumber%7D"><a href="module-core.html#index">index(arr_or_str, needle)</a> → {number}</h4><p>Searches for a value in an array and returns the index of the first matching occurrence.</p><pre class="prettyprint source"><code>let colors = [&quot;red&quot;, &quot;green&quot;, &quot;blue&quot;, &quot;green&quot;];
index(colors, &quot;green&quot;); // 1 (returns first match)
index(colors, &quot;yellow&quot;); // -1 (not found)
</code></pre><p>Unlike many other languages where array search functions return -1 or null for non-matching items, <code>index()</code> in ucode specifically returns -1 when the value isn't found. It returns null only if the first argument is neither an array nor a string.</p><h4 id="%7B%40link-module%3Acore%23rindex%7Crindex(arr_or_str%2C-needle)%7D-%E2%86%92-%7Bnumber%7D"><a href="module-core.html#rindex">rindex(arr_or_str, needle)</a> → {number}</h4><p>Similar to <code>index()</code>, but searches backward from the end of the array:</p><pre class="prettyprint source"><code>let colors = [&quot;red&quot;, &quot;green&quot;, &quot;blue&quot;, &quot;green&quot;];
rindex(colors, &quot;green&quot;); // 3 (last occurrence)
</code></pre><h4 id="checking-if-a-value-is-an-array">Checking if a Value is an Array</h4><p>To determine if a value is an array, use the <code>type()</code> function:</p><pre class="prettyprint source"><code>function isArray(value) {
    return type(value) == &quot;array&quot;;
}

isArray([1, 2, 3]); // true
isArray(&quot;string&quot;); // false
isArray({key: &quot;value&quot;}); // false
isArray(null); // false
</code></pre><p>The <code>type()</code> function is extremely useful for defensive programming, especially in ucode where functions often need to determine the type of their arguments to process them correctly.</p><h3 id="manipulation-functions">Manipulation Functions</h3><h4 id="%7B%40link-module%3Acore%23push%7Cpush(arr%2C-...values)%7D-%E2%86%92-%7B*%7D"><a href="module-core.html#push">push(arr, ...values)</a> → {*}</h4><p>Adds one or more elements to the end of an array and returns the last pushed value.</p><pre class="prettyprint source"><code>let x = [1, 2, 3];
push(x, 4, 5, 6); // 6
print(x); // [1, 2, 3, 4, 5, 6]
</code></pre><p>Returns null if the array was empty or if a non-array argument was passed.</p><h4 id="%7B%40link-module%3Acore%23pop%7Cpop(arr)%7D-%E2%86%92-%7B*%7D"><a href="module-core.html#pop">pop(arr)</a> → {*}</h4><p>Removes the last element from an array and returns it.</p><pre class="prettyprint source"><code>let x = [1, 2, 3];
let lastItem = pop(x); // 3
print(x); // [1, 2]
</code></pre><p>Returns null if the array was empty or if a non-array argument was passed.</p><h4 id="%7B%40link-module%3Acore%23unshift%7Cunshift(arr%2C-...values)%7D-%E2%86%92-%7B*%7D"><a href="module-core.html#unshift">unshift(arr, ...values)</a> → {*}</h4><p>Adds one or more elements to the beginning of an array and returns the last value added.</p><pre class="prettyprint source"><code>let x = [3, 4, 5];
unshift(x, 1, 2); // 2
print(x); // [1, 2, 3, 4, 5]
</code></pre><h4 id="%7B%40link-module%3Acore%23shift%7Cshift(arr)%7D-%E2%86%92-%7B*%7D"><a href="module-core.html#shift">shift(arr)</a> → {*}</h4><p>Removes the first element from an array and returns it.</p><pre class="prettyprint source"><code>let x = [1, 2, 3];
let firstItem = shift(x); // 1
print(x); // [2, 3]
</code></pre><p>Returns null if the array was empty or if a non-array argument was passed.</p><h3 id="transformation-functions">Transformation Functions</h3><h4 id="%7B%40link-module%3Acore%23map%7Cmap(arr%2C-fn)%7D-%E2%86%92-%7Barray%7D"><a href="module-core.html#map">map(arr, fn)</a> → {Array}</h4><p>Creates a new array populated with the results of calling a provided function on every element in the calling array.</p><pre class="prettyprint source"><code>let numbers = [1, 2, 3, 4];
let squares = map(numbers, x => x * x); // [1, 4, 9, 16]
</code></pre><p>Note: The callback function receives three arguments:</p><ol><li>The current element value</li><li>The current index</li><li>The array being processed</li></ol><pre class="prettyprint source"><code>let values = map([&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;], function(value, index, array) {
  return `${index}: ${value} (from array of length ${length(array)})`;
});
</code></pre><h5 id="important-pitfall-with-built-in-functions">Important Pitfall with Built-in Functions</h5><p>A common mistake when using <code>map()</code> is passing a built-in function directly as the callback. Consider this example attempting to convert an array of strings to integers:</p><pre class="prettyprint source"><code>// ⚠️ INCORRECT: This will not work as expected!
let strings = [&quot;10&quot;, &quot;32&quot;, &quot;13&quot;];
let nums = map(strings, int);  // Results will be unpredictable!
</code></pre><p>This fails because the <code>map()</code> function calls the callback with three arguments:</p><ol><li>The current value (<code>&quot;10&quot;</code>, <code>&quot;32&quot;</code>, etc.)</li><li>The current index (<code>0</code>, <code>1</code>, <code>2</code>)</li><li>The original array (<code>[&quot;10&quot;, &quot;32&quot;, &quot;13&quot;]</code>)</li></ol><p>So what actually happens is equivalent to:</p><pre class="prettyprint source"><code>int(&quot;10&quot;, 0, [&quot;10&quot;, &quot;32&quot;, &quot;13&quot;])  // Interprets 0 as base parameter!
int(&quot;32&quot;, 1, [&quot;10&quot;, &quot;32&quot;, &quot;13&quot;])  // Interprets 1 as base parameter!
int(&quot;13&quot;, 2, [&quot;10&quot;, &quot;32&quot;, &quot;13&quot;])  // Interprets 2 as base parameter!
</code></pre><p>The second argument to <code>int()</code> is interpreted as the numeric base, causing unexpected conversion results:</p><ul><li><code>&quot;10&quot;</code> in base 0 is interpreted as decimal 10 (base 0 is a special case that auto-detects the base)</li><li><code>&quot;32&quot;</code> in base 1 produces <code>NaN</code> because base 1 is invalid (a numeral system needs at least 2 distinct digits)</li><li><code>&quot;13&quot;</code> in base 2 produces <code>1</code> because in binary only <code>0</code> and <code>1</code> are valid digits - it converts <code>&quot;1&quot;</code> successfully and stops at the invalid character <code>&quot;3&quot;</code></li></ul><p>The actual result would be <code>[10, NaN, 1]</code>, which is certainly not what you'd expect when trying to convert string numbers to integers!</p><p>To fix this, wrap the function call in an arrow function or a regular function that controls the number of arguments:</p><pre class="prettyprint source"><code>// ✓ CORRECT: Using arrow function to control arguments
let strings = [&quot;10&quot;, &quot;32&quot;, &quot;13&quot;];
let nums = map(strings, x => int(x));  // [10, 32, 13]

// Alternative approach using a named function
function toInt(str) {
  return int(str);
}
let nums2 = map(strings, toInt);  // [10, 32, 13]
</code></pre><p>This pattern applies to many other built-in functions like <code>length()</code>, <code>trim()</code>, <code>b64enc()</code>, etc. Always wrap built-in functions when using them with <code>map()</code> to ensure they receive only the intended arguments.</p><h4 id="%7B%40link-module%3Acore%23filter%7Cfilter(arr%2C-fn)%7D-%E2%86%92-%7Barray%7D"><a href="module-core.html#filter">filter(arr, fn)</a> → {Array}</h4><p>Creates a new array with all elements that pass the test implemented by the provided function.</p><pre class="prettyprint source"><code>let numbers = [1, 2, 3, 4, 5, 6];
let evens = filter(numbers, x => x % 2 == 0); // [2, 4, 6]
</code></pre><p>The callback function receives the same three arguments as in <code>map()</code>.</p><h4 id="%7B%40link-module%3Acore%23sort%7Csort(arr%2C-fn)%7D-%E2%86%92-%7Barray%7D"><a href="module-core.html#sort">sort(arr, fn)</a> → {Array}</h4><p>Sorts the elements of an array in place and returns the sorted array, optionally using a custom compare function.</p><pre class="prettyprint source"><code>let numbers = [3, 1, 4, 2];
sort(numbers); // [1, 2, 3, 4]
</code></pre><p>With a custom compare function:</p><pre class="prettyprint source"><code>let people = [
  { name: &quot;Alice&quot;, age: 25 },
  { name: &quot;Bob&quot;, age: 30 },
  { name: &quot;Charlie&quot;, age: 20 }
];

sort(people, (a, b) => a.age - b.age);
// [{ name: &quot;Charlie&quot;, age: 20 }, { name: &quot;Alice&quot;, age: 25 }, { name: &quot;Bob&quot;, age: 30 }]
</code></pre><h4 id="%7B%40link-module%3Acore%23reverse%7Creverse(arr)%7D-%E2%86%92-%7Barray%7D"><a href="module-core.html#reverse">reverse(arr)</a> → {Array}</h4><p>Returns a new array with the order of all elements reversed.</p><pre class="prettyprint source"><code>let arr = [1, 2, 3];
reverse(arr); // [3, 2, 1]
</code></pre><p>This function also works on strings:</p><pre class="prettyprint source"><code>reverse(&quot;hello&quot;); // &quot;olleh&quot;
</code></pre><p>Returns null if the argument is neither an array nor a string.</p><h4 id="%7B%40link-module%3Acore%23uniq%7Cuniq(array)%7D-%E2%86%92-%7Barray%7D"><a href="module-core.html#uniq">uniq(array)</a> → {Array}</h4><p>Creates a new array with all duplicate elements removed.</p><pre class="prettyprint source"><code>let array = [1, 2, 2, 3, 1, 4, 5, 4];
uniq(array); // [1, 2, 3, 4, 5]
</code></pre><p>Returns null if a non-array argument is given.</p><h3 id="helper-functions-and-recipes">Helper Functions and Recipes</h3><p>The ucode standard library provides essential array functions, but many common operations must be implemented manually. Below, you'll find example implementations for frequently needed array operations that aren't built into the core library.</p><p>These recipes demonstrate how to leverage ucode's existing functions to build more complex array utilities.</p><h4 id="array-intersection">Array Intersection</h4><p>Returns a new array containing elements present in all provided arrays.</p><pre class="prettyprint source"><code>function intersect(...arrays) {
  if (!length(arrays))
    return [];

  let result = arrays[0];

  for (let i = 1; i &lt; length(arrays); i++) {
    result = filter(result, item => item in arrays[i]);
  }

  return uniq(result);
}

// Example usage:
let a = [1, 2, 3, 4];
let b = [2, 3, 5];
let c = [2, 3, 6];
intersect(a, b, c); // [2, 3]
</code></pre><p>This implementation takes advantage of ucode's <code>in</code> operator, which checks if a value exists in an array using strict equality comparison. This makes the code more concise than using <code>index()</code> and checking if the result is not -1.</p><h4 id="array-merge%2Fconcatenation">Array Merge/Concatenation</h4><p>Combines multiple arrays into a new array. Taking advantage of ucode's variadic <code>push()</code> function with the spread operator provides an elegant solution:</p><pre class="prettyprint source"><code>function merge(...arrays) {
  let result = [];

  for (arr in arrays) {
    push(result, ...arr);  // Spreads all elements from the array directly into push
  }

  return result;
}

// Example usage:
let a = [1, 2];
let b = [3, 4];
let c = [5, 6];
merge(a, b, c); // [1, 2, 3, 4, 5, 6]
</code></pre><p>This implementation leverages the variadic nature of <code>push()</code>, which accepts any number of arguments. The spread operator (<code>...</code>) unpacks each array, passing all its elements as individual arguments to <code>push()</code>. This is both more efficient and more readable than nested loops.</p><p>For processing very large arrays, you might want to use a batching approach to avoid potential call stack limitations:</p><pre class="prettyprint source"><code>function mergeWithBatching(...arrays) {
  let result = [];
  const BATCH_SIZE = 1000;

  for (arr in arrays) {
    // Handle array in batches to avoid excessive function arguments
    for (let i = 0; i &lt; length(arr); i += BATCH_SIZE) {
      let batch = slice(arr, i, i + BATCH_SIZE);
      push(result, ...batch);
    }
  }

  return result;
}
</code></pre><h4 id="array-difference">Array Difference</h4><p>Returns elements in the first array not present in subsequent arrays.</p><pre class="prettyprint source"><code>function difference(array, ...others) {
  return filter(array, item => {
    for (other in others) {
      if (item in other)
        return false;
    }
    return true;
  });
}

// Example usage:
let a = [1, 2, 3, 4, 5];
let b = [2, 3];
let c = [4];
difference(a, b, c); // [1, 5]
</code></pre><p>This implementation uses the <code>in</code> operator for concise and efficient membership testing, filtering out any elements from the first array that appear in any of the subsequent arrays.</p><h4 id="array-chunk">Array Chunk</h4><p>Splits an array into chunks of specified size.</p><pre class="prettyprint source"><code>function chunk(array, size) {
  if (size &lt;= 0)
    return [];

  let result = [];

  for (let i = 0; i &lt; length(array); i += size) {
    push(result, slice(array, i, i + size));
  }

  return result;
}

// Example usage:
let nums = [1, 2, 3, 4, 5, 6, 7, 8];
chunk(nums, 3); // [[1, 2, 3], [4, 5, 6], [7, 8]]
</code></pre><p>This implementation uses a counting <code>for</code> loop combined with <code>slice()</code>, which is both more idiomatic and more efficient. The approach:</p><ol><li>Iterates through the array in steps of <code>size</code></li><li>Uses <code>slice()</code> to extract chunks of the appropriate size</li><li>Automatically handles the last chunk being smaller if the array length isn't divisible by the chunk size</li></ol><p>This pattern leverages ucode's built-in functions for cleaner, more maintainable code. No temporary variables are needed to track the current chunk or count, making the implementation more straightforward.</p><h4 id="array-sum">Array Sum</h4><p>Calculates the sum of all numeric elements in an array.</p><pre class="prettyprint source"><code>function sum(array) {
  let result = 0;

  for (item in array) {
    if (type(item) == &quot;int&quot; || type(item) == &quot;double&quot;)
      result += item;
  }

  return result;
}

// Example usage:
let nums = [1, 2, 3, 4, 5];
sum(nums); // 15
</code></pre><h4 id="array-flatten">Array Flatten</h4><p>Flattens a nested array structure.</p><pre class="prettyprint source"><code>function flatten(array, depth) {
  if (depth === undefined)
    depth = 1;

  let result = [];

  for (item in array) {
    if (type(item) == &quot;array&quot; && depth > 0) {
      let flattened = flatten(item, depth - 1);
      for (subItem in flattened) {
        push(result, subItem);
      }
    } else {
      push(result, item);
    }
  }

  return result;
}

// Example usage:
let nested = [1, [2, [3, 4], 5], 6];
flatten(nested);     // [1, 2, [3, 4], 5, 6]
flatten(nested, 2);  // [1, 2, 3, 4, 5, 6]
</code></pre><h2 id="advanced-array-techniques-and-considerations">Advanced Array Techniques and Considerations</h2><h3 id="memory-management">Memory Management</h3><p>When working with arrays in ucode, you should understand several important memory characteristics that affect performance and resource usage:</p><h4 id="sparse-array-memory-implications">Sparse Array Memory Implications</h4><p>Since ucode arrays are true arrays in memory, array memory consumption scales linearly with the highest index used, regardless of how many elements are actually stored:</p><pre class="prettyprint source"><code>let arr = [];
arr[1000000] = &quot;value&quot;; // Allocates memory for 1,000,001 pointers
</code></pre><p>Important technical details about ucode array memory usage:</p><ul><li>Each array element consumes pointer-sized memory (4 bytes on 32-bit systems, 8 bytes on 64-bit systems)</li><li>No optimizations exist for sparse arrays - every position up to the highest index is allocated</li><li>When an array grows beyond its capacity, it's reallocated with a growth factor of 1.5</li><li>Memory is allocated even for &quot;empty&quot; slots (which contain the <code>null</code> value)</li></ul><p>For example, on a 64-bit system, creating an array with a single element at index 1,000,000 would consume approximately 8MB of memory (1,000,001 * 8 bytes), even though only one actual value is stored.</p><pre class="prettyprint source"><code>// Demonstrates memory consumption
let smallArray = [];
for (let i = 0; i &lt; 10; i++)
  smallArray[i] = i;

let sparseArray = [];
sparseArray[1000000] = &quot;far away&quot;;

print(`Small array has ${length(smallArray)} elements\n`);
print(`Sparse array has ${length(sparseArray)} elements\n`);
// Even though only one value is actually set, memory is allocated for all positions
</code></pre><p>This behavior makes ucode arrays efficient for random access but potentially wasteful for very sparse data structures. For data with large gaps or when working on memory-constrained systems, consider alternative approaches like objects with numeric string keys.</p><h4 id="negative-index-implementation">Negative Index Implementation</h4><p>While negative indices provide convenient access to elements from the end of an array, they involve an internal conversion process:</p><pre class="prettyprint source"><code>let arr = [1, 2, 3, 4, 5];
arr[-1]; // Internally converted to arr[length(arr) - 1], or arr[4]
arr[-3]; // Internally converted to arr[length(arr) - 3], or arr[2]
</code></pre><p>This conversion adds a small computational overhead compared to direct positive indexing. For performance-critical code processing large arrays, consider using positive indices when possible.</p><h4 id="mixed-type-arrays-and-sorting">Mixed-Type Arrays and Sorting</h4><p>Arrays in ucode can contain mixed types, offering great flexibility but requiring careful handling, especially with operations like <code>sort()</code>:</p><pre class="prettyprint source"><code>let mixed = [&quot;apple&quot;, 10, true, {name: &quot;object&quot;}, [1, 2]];

// Sort behaves differently with mixed types
// Numbers come first, then arrays, then strings, then booleans, then objects
sort(mixed); // [10, [1, 2], &quot;apple&quot;, true, {name: &quot;object&quot;}]
</code></pre><p>When sorting mixed-type arrays, consider implementing a custom comparison function to define the sorting behavior explicitly:</p><pre class="prettyprint source"><code>function mixedTypeSort(a, b) {
    // Sort by type first, then by value
    let typeA = type(a);
    let typeB = type(b);

    if (typeA != typeB) {
        // Define a type precedence order
        let typePrecedence = {
            &quot;int&quot;: 1,
            &quot;double&quot;: 2,
            &quot;string&quot;: 3,
            &quot;bool&quot;: 4,
            &quot;array&quot;: 5,
            &quot;object&quot;: 6
        };
        return typePrecedence[typeA] - typePrecedence[typeB];
    }

    // If same type, compare values appropriately
    if (typeA == &quot;string&quot; || typeA == &quot;array&quot;)
        return length(a) - length(b);
    return a - b;
}

// Now sorting is more predictable
sort(mixed, mixedTypeSort);
</code></pre><h3 id="performance-optimization">Performance Optimization</h3><p>When working with large arrays, consider these optimization techniques:</p><ol><li><strong>Pre-allocation</strong>: Where possible, create arrays with known capacity rather than growing incrementally</li><li><strong>Batch operations</strong>: Minimize individual push/pop/shift/unshift calls by processing in batches</li><li><strong>Avoid unnecessary copies</strong>: Use in-place operations when possible</li><li><strong>Filter early</strong>: Filter arrays early in processing pipelines to reduce subsequent operation sizes</li></ol><h3 id="array-deep-copying">Array Deep Copying</h3><p>Since arrays are reference types, creating true copies requires special handling:</p><pre class="prettyprint source"><code>function deepCopy(arr) {
    if (type(arr) != &quot;array&quot;)
        return arr;

    let result = [];
    for (item in arr) {
        if (type(item) == &quot;array&quot;)
            push(result, deepCopy(item));
        else if (type(item) == &quot;object&quot;)
            push(result, deepCopyObject(item));
        else
            push(result, item);
    }
    return result;
}

function deepCopyObject(obj) {
    if (type(obj) != &quot;object&quot;)
        return obj;

    let result = {};
    for (key in keys(obj)) {
        if (type(obj[key]) == &quot;array&quot;)
            result[key] = deepCopy(obj[key]);
        else if (type(obj[key]) == &quot;object&quot;)
            result[key] = deepCopyObject(obj[key]);
        else
            result[key] = obj[key];
    }
    return result;
}
</code></pre><p>This approach ensures all nested arrays and objects are properly copied rather than referenced.</p></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button> <button class="icon-button" id="mobile-toc" data-isopen="false" aria-label="toc"><svg><use xlink:href="#toc-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">ucode Documentation</a><div class="mobile-nav-links"><div class="github-home navbar-item"><a id="" href="https://github.com/jow-/ucode" target="">GitHub Project Page</a></div></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="KaA85LdlHsGxxA-wrqimQ"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-01-usage.html">Usage</a></div><div class="sidebar-section-children"><a href="tutorial-02-syntax.html">Syntax</a></div><div class="sidebar-section-children"><a href="tutorial-03-memory.html">Memory Management</a></div><div class="sidebar-section-children"><a href="tutorial-04-arrays.html">Working with Arrays</a></div><div class="sidebar-section-children"><a href="tutorial-05-dictionaries.html">Working with Dictionaries</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="vaQEPYkoMxBighD_rEvKz"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-core.html">core</a></div><div class="sidebar-section-children"><a href="module-debug.html">debug</a></div><div class="sidebar-section-children"><a href="module-digest.html">digest</a></div><div class="sidebar-section-children"><a href="module-fs.html">fs</a></div><div class="sidebar-section-children"><a href="module-io.html">io</a></div><div class="sidebar-section-children"><a href="module-log.html">log</a></div><div class="sidebar-section-children"><a href="module-math.html">math</a></div><div class="sidebar-section-children"><a href="module-nl80211.html">nl80211</a></div><div class="sidebar-section-children"><a href="module-resolv.html">resolv</a></div><div class="sidebar-section-children"><a href="module-rtnl.html">rtnl</a></div><div class="sidebar-section-children"><a href="module-socket.html">socket</a></div><div class="sidebar-section-children"><a href="module-struct.html">struct</a></div><div class="sidebar-section-children"><a href="module-uci.html">uci</a></div><div class="sidebar-section-children"><a href="module-uloop.html">uloop</a></div><div class="sidebar-section-children"><a href="module-zlib.html">zlib</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#dark-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div><div class="navbar-right-item toc-item"><button class="icon-button toc" aria-label="open-table-of-contents"><svg><use xlink:href="#toc-icon"></use></svg></button></div></div></div></div><div id="mobile-tocbar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><span class="sidebar-title">Table of Contents</span><div class="toc-contents"></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#mobile-tocbar > .mobile-sidebar-wrapper > .toc-contents",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:(...e)=>{hideMobileMenu(),bringLinkToView(...e)},includeHtml:!0})</script></body></html>