<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link type="text/css" rel="stylesheet" href="ucode.css"><title>Tutorial: Working with Dictionaries</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="";baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol><symbol id="toc-icon" viewBox="0 0 460 460"><path d="M40 70a40 40 0 1 0 0 80 40 40 0 0 0 0-80zM40 190a40 40 0 1 0 0 80 40 40 0 0 0 0-80zM40 310a40 40 0 1 0 0 80 40 40 0 0 0 0-80zM430 80H145a30 30 0 0 0 0 60h285a30 30 0 0 0 0-60zM430 200H145a30 30 0 0 0 0 60h285a30 30 0 0 0 0-60zM430 320H145a30 30 0 0 0 0 60h285a30 30 0 0 0 0-60z"/></symbol></defs></svg></head><body data-theme="light"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">ucode Documentation</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="EGNcbMBDtXXQIS7_KC-yn"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-01-usage.html">Usage</a></div><div class="sidebar-section-children"><a href="tutorial-02-syntax.html">Syntax</a></div><div class="sidebar-section-children"><a href="tutorial-03-memory.html">Memory Management</a></div><div class="sidebar-section-children"><a href="tutorial-04-arrays.html">Working with Arrays</a></div><div class="sidebar-section-children"><a href="tutorial-05-dictionaries.html">Working with Dictionaries</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="pNEJb8uuqCcUZna8YADYC"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-core.html">core</a></div><div class="sidebar-section-children"><a href="module-debug.html">debug</a></div><div class="sidebar-section-children"><a href="module-digest.html">digest</a></div><div class="sidebar-section-children"><a href="module-fs.html">fs</a></div><div class="sidebar-section-children"><a href="module-log.html">log</a></div><div class="sidebar-section-children"><a href="module-math.html">math</a></div><div class="sidebar-section-children"><a href="module-resolv.html">resolv</a></div><div class="sidebar-section-children"><a href="module-socket.html">socket</a></div><div class="sidebar-section-children"><a href="module-struct.html">struct</a></div><div class="sidebar-section-children"><a href="module-uci.html">uci</a></div><div class="sidebar-section-children"><a href="module-uloop.html">uloop</a></div><div class="sidebar-section-children"><a href="module-zlib.html">zlib</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"><div class="github-home navbar-item"><a id="" href="https://github.com/jow-/ucode" target="">GitHub Project Page</a></div></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#dark-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div><div class="navbar-right-item toc-item"><button class="icon-button toc" aria-label="open-table-of-contents"><svg><use xlink:href="#toc-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section><header><h2>Working with Dictionaries</h2></header><article><p>Dictionaries in ucode (also referred to as objects) are key-value collections that provide efficient lookups by key. Unlike arrays which use numeric indices, dictionaries use string keys to access values. Understanding how dictionaries are implemented in ucode and their distinctive characteristics will help you write more efficient and effective code.</p><h2 id="key-characteristics-of-ucode-dictionaries">Key Characteristics of Ucode Dictionaries</h2><h3 id="hash-table-implementation-with-ordered-keys">Hash Table Implementation with Ordered Keys</h3><p>Ucode dictionaries are implemented as ordered hash tables, which means:</p><ul><li>They offer fast O(1) average-case lookups by key</li><li>Keys are hashed to determine storage location</li><li>Memory allocation is dynamic and grows as needed</li><li>Unlike arrays, memory is not allocated contiguously</li><li>Key order is preserved based on declaration or assignment sequence</li><li>Keys can be reordered using <code>sort()</code></li></ul><h3 id="string-only-keys-with-important-limitations">String-Only Keys with Important Limitations</h3><p>One important limitation of ucode dictionaries:</p><ul><li>All keys must be strings</li><li>Non-string keys are implicitly converted to strings</li><li>Numeric keys become string representations (e.g., <code>5</code> becomes <code>&quot;5&quot;</code>)</li><li>This differs from JavaScript where objects can use Symbols as keys</li></ul><h4 id="warning%3A-null-byte-truncation-in-keys">Warning: Null Byte Truncation in Keys</h4><p>A critical implementation detail to be aware of is that dictionary keys containing null bytes (<code>\0</code>) will be silently truncated at the first null byte:</p><pre class="prettyprint source"><code>let dict = {&quot;foo\0bar&quot;: 123};
print(dict.foo);  // 123
print(exists(dict, &quot;foo\0bar&quot;));  // false
print(exists(dict, &quot;foo&quot;));  // true
</code></pre><p>This happens because the underlying hash table implementation treats keys as C-style null-terminated strings. While this behavior may change in future versions of ucode, you should currently:</p><ul><li>Never use keys containing null bytes</li><li>Sanitize any untrusted external input used as dictionary keys</li><li>Be especially careful when using binary data or user input as keys</li></ul><p>This issue can lead to subtle bugs and potential security vulnerabilities if malicious users craft input with embedded null bytes to manipulate key lookups.</p><h3 id="type-flexibility-for-values">Type Flexibility for Values</h3><p>Like arrays, dictionary values in ucode can be of any type:</p><ul><li>Booleans, numbers (integers and doubles), strings</li><li>Objects and arrays (allowing nested structures)</li><li>Functions and null values</li><li>Different keys can store different value types</li></ul><h3 id="reference-semantics">Reference Semantics</h3><p>Dictionaries are reference types in ucode:</p><ul><li>Assigning a dictionary to a new variable creates a reference, not a copy</li><li>Modifying a dictionary through any reference affects all references</li><li>Equality comparisons test reference identity, not structural equality</li></ul><h2 id="core-dictionary-functions">Core Dictionary Functions</h2><h3 id="dictionary-information-functions">Dictionary Information Functions</h3><h4 id="%7B%40link-module%3Acore%23length%7Clength(x)%7D-%E2%86%92-%7Bnumber%7D"><a href="module-core.html#length">length(x)</a> → {number}</h4><p>Returns the number of keys in a dictionary.</p><pre class="prettyprint source"><code>let user = {name: &quot;Alice&quot;, age: 30, role: &quot;Admin&quot;};
length(user); // 3

let empty = {};
length(empty); // 0
</code></pre><p>For dictionaries, <code>length()</code> returns the count of keys. If the input is not an array, string, or object, <code>length()</code> returns null.</p><h4 id="%7B%40link-module%3Acore%23keys%7Ckeys(obj)%7D-%E2%86%92-%7Barray%7D"><a href="module-core.html#keys">keys(obj)</a> → {Array}</h4><p>Returns an array containing all keys in the dictionary.</p><pre class="prettyprint source"><code>let config = {debug: true, timeout: 500, retries: 3};
keys(config); // [&quot;debug&quot;, &quot;timeout&quot;, &quot;retries&quot;]
</code></pre><p>Unlike many other languages, ucode maintains key ordering based on declaration or assignment order. Keys are returned in the same order they were defined or assigned.</p><h4 id="%7B%40link-module%3Acore%23values%7Cvalues(obj)%7D-%E2%86%92-%7Barray%7D"><a href="module-core.html#values">values(obj)</a> → {Array}</h4><p>Returns an array containing all values in the dictionary.</p><pre class="prettyprint source"><code>let counts = {apples: 5, oranges: 10, bananas: 7};
values(counts); // [5, 10, 7]
</code></pre><p>The returned values correspond to the declaration/assignment order of keys in the dictionary, matching the order that would be returned by <code>keys()</code>.</p><h4 id="%7B%40link-module%3Acore%23exists%7Cexists(obj%2C-key)%7D-%E2%86%92-%7Bboolean%7D"><a href="module-core.html#exists">exists(obj, key)</a> → {boolean}</h4><p>Checks whether a key exists in a dictionary.</p><pre class="prettyprint source"><code>let settings = {theme: &quot;dark&quot;, fontSize: 16};
exists(settings, &quot;theme&quot;); // true
exists(settings, &quot;language&quot;); // false
</code></pre><p>This function offers a straightforward way to check for key existence without accessing the value.</p><h4 id="checking-if-a-value-is-a-dictionary">Checking if a Value is a Dictionary</h4><p>To determine if a value is a dictionary (object), use the <code>type()</code> function:</p><pre class="prettyprint source"><code>function isObject(value) {
    return type(value) == &quot;object&quot;;
}

isObject({key: &quot;value&quot;}); // true
isObject([1, 2, 3]); // false
isObject(&quot;string&quot;); // false
isObject(null); // false
</code></pre><h3 id="manipulation-functions">Manipulation Functions</h3><p>In ucode, dictionary manipulation is performed primarily through direct property access using dot notation or bracket notation.</p><h4 id="adding-or-updating-properties">Adding or Updating Properties</h4><pre class="prettyprint source"><code>let user = {name: &quot;Bob&quot;};

// Adding new properties
user.age = 25;
user[&quot;email&quot;] = &quot;bob@example.com&quot;;

// Updating existing properties
user.name = &quot;Robert&quot;;
user[&quot;age&quot;] += 1;

print(user); // {name: &quot;Robert&quot;, age: 26, email: &quot;bob@example.com&quot;}
</code></pre><h4 id="removing-properties">Removing Properties</h4><p>Properties can be removed using the <code>delete</code> operator:</p><pre class="prettyprint source"><code>let product = {id: &quot;p123&quot;, name: &quot;Laptop&quot;, price: 999, discontinued: false};

delete product.discontinued;
print(product); // {id: &quot;p123&quot;, name: &quot;Laptop&quot;, price: 999}

delete product[&quot;price&quot;];
print(product); // {id: &quot;p123&quot;, name: &quot;Laptop&quot;}
</code></pre><h4 id="merging-dictionaries">Merging Dictionaries</h4><p>Ucode supports using spread expressions to merge dictionaries elegantly:</p><pre class="prettyprint source"><code>let defaults = {theme: &quot;light&quot;, fontSize: 12, notifications: true};
let userSettings = {theme: &quot;dark&quot;};

// Merge dictionaries with spread syntax
let merged = {...defaults, ...userSettings};
print(merged); // {theme: &quot;dark&quot;, fontSize: 12, notifications: true}
</code></pre><p>When merging with spread syntax, properties from later objects overwrite those from earlier objects if the keys are the same. This provides a clean way to implement default options with overrides:</p><pre class="prettyprint source"><code>// Apply user preferences with fallbacks
let config = {
    ...systemDefaults,
    ...globalSettings,
    ...userPreferences
};
</code></pre><p>For situations requiring more complex merging logic, you can implement a custom function:</p><pre class="prettyprint source"><code>function merge(target, ...sources) {
    for (source in sources) {
        for (key in keys(source)) {
            target[key] = source[key];
        }
    }
    return target;
}

let defaults = {theme: &quot;light&quot;, fontSize: 12, notifications: true};
let userSettings = {theme: &quot;dark&quot;};
let merged = merge({}, defaults, userSettings);
print(merged); // {theme: &quot;dark&quot;, fontSize: 12, notifications: true}
</code></pre><p>Note that this performs a shallow merge. For nested objects, a deep merge would be needed:</p><pre class="prettyprint source"><code>function deepMerge(target, ...sources) {
    if (!sources.length) return target;

    for (source in sources) {
        if (type(source) !== &quot;object&quot;) continue;

        for (key in keys(source)) {
            if (type(source[key]) == &quot;object&quot; && type(target[key]) == &quot;object&quot;) {
                // Recursively merge nested objects
                target[key] = deepMerge({...target[key]}, source[key]);
            } else {
                // For primitive values or when target key doesn't exist/isn't an object
                target[key] = source[key];
            }
        }
    }

    return target;
}

let userProfile = {
    name: &quot;Alice&quot;,
    preferences: {
        theme: &quot;light&quot;,
        sidebar: {
            visible: true,
            width: 250
        }
    }
};

let updates = {
    preferences: {
        theme: &quot;dark&quot;,
        sidebar: {
            width: 300
        }
    }
};

let merged = deepMerge({}, userProfile, updates);
/* Result:
{
    name: &quot;Alice&quot;,
    preferences: {
        theme: &quot;dark&quot;,
        sidebar: {
            visible: true,
            width: 300
        }
    }
}
*/
</code></pre><h3 id="iteration-techniques">Iteration Techniques</h3><h4 id="iterating-with-for-in">Iterating with for-in</h4><p>The most common way to iterate through a dictionary is using <code>for-in</code>:</p><pre class="prettyprint source"><code>let metrics = {visits: 1024, conversions: 85, bounceRate: 0.35};

for (key in metrics) {
    printf(&quot;%s: %J\n&quot;, key, metrics[key]);
}
// Output:
// visits: 1024
// conversions: 85
// bounceRate: 0.35
</code></pre><h4 id="iterating-over-entries-(key-value-pairs)">Iterating over Entries (Key-Value Pairs)</h4><p>A more advanced iteration technique gives access to both keys and values:</p><pre class="prettyprint source"><code>let product = {name: &quot;Widget&quot;, price: 19.99, inStock: true};

for (key in keys(product)) {
    let value = product[key];
    printf(&quot;%s: %J\n&quot;, key, value);
}
</code></pre><h4 id="enhanced-for-in-loop">Enhanced for-in Loop</h4><p>Ucode provides an enhanced for-in loop that can destructure keys and values:</p><pre class="prettyprint source"><code>let inventory = {apples: 50, oranges: 25, bananas: 30};

for (item, quantity in inventory) {
    printf(&quot;We have %d %s in stock\n&quot;, quantity, item);
}
// Output:
// We have 50 apples in stock
// We have 25 oranges in stock
// We have 30 bananas in stock
</code></pre><p>This syntax offers a more elegant way to work with both keys and values simultaneously.</p><h2 id="key-ordering-and-sorting">Key Ordering and Sorting</h2><p>One distinctive feature of ucode dictionaries is their predictable key ordering. Unlike many other languages where hash-based dictionaries have arbitrary or implementation-dependent key ordering, ucode maintains key order based on declaration or assignment sequence.</p><h3 id="predictable-iteration-order">Predictable Iteration Order</h3><p>When iterating through a dictionary, keys are always processed in their insertion order:</p><pre class="prettyprint source"><code>let scores = {};
scores.alice = 95;
scores.bob = 87;
scores.charlie = 92;

// Keys will be iterated in the exact order they were added
for (name in scores) {
    printf(&quot;%s: %d\n&quot;, name, scores[name]);
}
// Output will consistently be:
// alice: 95
// bob: 87
// charlie: 92
</code></pre><p>This predictable ordering applies to all dictionary operations: for-in loops, <code>keys()</code>, and <code>values()</code>.</p><h3 id="sorting-dictionary-keys">Sorting Dictionary Keys</h3><p>You can explicitly reorder dictionary keys using the <code>sort()</code> function:</p><pre class="prettyprint source"><code>let stats = {
    average: 72.5,
    median: 68,
    mode: 65,
    range: 45
};

// Sort keys alphabetically
sort(stats);

// Now keys will be iterated in alphabetical order
for (metric in stats) {
    printf(&quot;%s: %J\n&quot;, metric, stats[metric]);
}
// Output:
// average: 72.5
// median: 68
// mode: 65
// range: 45
</code></pre><p>Custom sorting is also supported:</p><pre class="prettyprint source"><code>let inventory = {
    apples: 45,
    bananas: 25,
    oranges: 30,
    grapes: 60
};

// Sort by value (quantity) in descending order
sort(inventory, (k1, k2, v1, v2) => v2 - v1);

// Keys will now be ordered by their associated values
for (fruit, quantity in inventory) {
    printf(&quot;%s: %d\n&quot;, fruit, quantity);
}
// Output:
// grapes: 60
// apples: 45
// oranges: 30
// bananas: 25
</code></pre><p>This ability to maintain and manipulate key order makes ucode dictionaries particularly useful for:</p><ul><li>Configuration objects where property order matters</li><li>UI element definitions that should be processed in a specific sequence</li><li>Data structures that need to maintain insertion chronology</li></ul><h2 id="advanced-dictionary-techniques">Advanced Dictionary Techniques</h2><h3 id="nested-dictionaries">Nested Dictionaries</h3><p>Dictionaries can contain other dictionaries, allowing for complex data structures:</p><pre class="prettyprint source"><code>let company = {
    name: &quot;Acme Corp&quot;,
    founded: 1985,
    address: {
        street: &quot;123 Main St&quot;,
        city: &quot;Metropolis&quot;,
        zipCode: &quot;12345&quot;
    },
    departments: {
        engineering: {
            headCount: 50,
            projects: [&quot;Alpha&quot;, &quot;Beta&quot;, &quot;Gamma&quot;]
        },
        sales: {
            headCount: 30,
            regions: [&quot;North&quot;, &quot;South&quot;, &quot;East&quot;, &quot;West&quot;]
        }
    }
};

// Accessing nested properties
printf(&quot;Engineering headcount: %d\n&quot;, company.departments.engineering.headCount);
</code></pre><h3 id="dictionary-as-a-cache">Dictionary as a Cache</h3><p>Dictionaries are excellent for implementing caches or memoization:</p><pre class="prettyprint source"><code>function memoizedFibonacci() {
    let cache = {};

    // Return the actual fibonacci function with closure over cache
    return function fib(n) {
        // Check if result exists in cache
        if (exists(cache, n)) {
            return cache[n];
        }

        // Calculate result for new inputs
        let result;
        if (n &lt;= 1) {
            result = n;
        } else {
            result = fib(n-1) + fib(n-2);
        }

        // Store result in cache
        cache[n] = result;
        return result;
    };
}

let fibonacci = memoizedFibonacci();
printf(&quot;Fibonacci 40: %d\n&quot;, fibonacci(40)); // Fast computation due to caching
</code></pre><h3 id="using-dictionaries-for-lookups">Using Dictionaries for Lookups</h3><p>Dictionaries excel at lookup tables and can replace complex conditional logic:</p><pre class="prettyprint source"><code>// Instead of:
function getStatusMessage(code) {
    if (code == 200) return &quot;OK&quot;;
    else if (code == 404) return &quot;Not Found&quot;;
    else if (code == 500) return &quot;Server Error&quot;;
    // ...and so on
    return &quot;Unknown Status&quot;;
}

// Use a dictionary:
let statusMessages = {
    &quot;200&quot;: &quot;OK&quot;,
    &quot;404&quot;: &quot;Not Found&quot;,
    &quot;500&quot;: &quot;Server Error&quot;
};

function getStatusMessage(code) {
    return statusMessages[code] ?? &quot;Unknown Status&quot;;
}
</code></pre><h3 id="dictionary-patterns-and-recipes">Dictionary Patterns and Recipes</h3><h4 id="deep-clone">Deep Clone</h4><p>Creating a deep copy of a dictionary with nested objects:</p><pre class="prettyprint source"><code>function deepClone(obj) {
    if (type(obj) != &quot;object&quot;) {
        return obj;
    }

    let clone = {};
    for (key in keys(obj)) {
        if (type(obj[key]) == &quot;object&quot;) {
            clone[key] = deepClone(obj[key]);
        } else if (type(obj[key]) == &quot;array&quot;) {
            clone[key] = deepCloneArray(obj[key]);
        } else {
            clone[key] = obj[key];
        }
    }
    return clone;
}

function deepCloneArray(arr) {
    let result = [];
    for (item in arr) {
        if (type(item) == &quot;object&quot;) {
            push(result, deepClone(item));
        } else if (type(item) == &quot;array&quot;) {
            push(result, deepCloneArray(item));
        } else {
            push(result, item);
        }
    }
    return result;
}
</code></pre><h4 id="dictionary-filtering">Dictionary Filtering</h4><p>Creating a new dictionary with only desired key-value pairs:</p><pre class="prettyprint source"><code>function filterObject(obj, filterFn) {
    let result = {};
    for (key in keys(obj)) {
        if (filterFn(key, obj[key])) {
            result[key] = obj[key];
        }
    }
    return result;
}

// Example: Keep only numeric values
let mixed = {a: 1, b: &quot;string&quot;, c: 3, d: true, e: 4.5};
let numbersOnly = filterObject(mixed, (key, value) =>
    type(value) == &quot;int&quot; || type(value) == &quot;double&quot;
);
print(numbersOnly); // {a: 1, c: 3, e: 4.5}
</code></pre><h4 id="object-mapping">Object Mapping</h4><p>Transforming values in a dictionary while keeping the same keys:</p><pre class="prettyprint source"><code>function mapObject(obj, mapFn) {
    let result = {};
    for (key in keys(obj)) {
        result[key] = mapFn(key, obj[key]);
    }
    return result;
}

// Example: Double all numeric values
let prices = {apple: 1.25, banana: 0.75, cherry: 2.50};
let discountedPrices = mapObject(prices, (fruit, price) => price * 0.8);
print(discountedPrices); // {apple: 1, banana: 0.6, cherry: 2}
</code></pre><h4 id="dictionary-equality">Dictionary Equality</h4><p>Comparing dictionaries by value instead of by reference:</p><pre class="prettyprint source"><code>function objectEquals(obj1, obj2) {
    // Check if both are objects
    if (type(obj1) != &quot;object&quot; || type(obj2) != &quot;object&quot;) {
        return obj1 === obj2;
    }

    // Check key count
    let keys1 = keys(obj1);
    let keys2 = keys(obj2);
    if (length(keys1) != length(keys2)) {
        return false;
    }

    // Check each key-value pair
    for (key in keys1) {
        if (!exists(obj2, key)) {
            return false;
        }

        if (type(obj1[key]) == &quot;object&quot; && type(obj2[key]) == &quot;object&quot;) {
            // Recursively check nested objects
            if (!objectEquals(obj1[key], obj2[key])) {
                return false;
            }
        } else if (type(obj1[key]) == &quot;array&quot; && type(obj2[key]) == &quot;array&quot;) {
            // For arrays, we would need array equality check
            if (!arrayEquals(obj1[key], obj2[key])) {
                return false;
            }
        } else if (obj1[key] !== obj2[key]) {
            return false;
        }
    }
    return true;
}

function arrayEquals(arr1, arr2) {
    if (length(arr1) != length(arr2)) {
        return false;
    }

    for (let i = 0; i &lt; length(arr1); i++) {
        if (type(arr1[i]) == &quot;object&quot; && type(arr2[i]) == &quot;object&quot;) {
            if (!objectEquals(arr1[i], arr2[i])) {
                return false;
            }
        } else if (type(arr1[i]) == &quot;array&quot; && type(arr2[i]) == &quot;array&quot;) {
            if (!arrayEquals(arr1[i], arr2[i])) {
                return false;
            }
        } else if (arr1[i] !== arr2[i]) {
            return false;
        }
    }
    return true;
}
</code></pre><h2 id="performance-considerations-and-best-practices">Performance Considerations and Best Practices</h2><h3 id="hash-collision-impacts">Hash Collision Impacts</h3><p>Since ucode dictionaries use hash tables:</p><ul><li>Hash collisions can occur (different keys hash to same value)</li><li>Hash collision resolution affects performance</li><li>As dictionaries grow large, performance degradation may occur</li><li>Performance is generally consistent but can have occasional spikes due to rehashing</li></ul><h3 id="key-naming-considerations">Key Naming Considerations</h3><p>String keys have important implications:</p><ul><li>Choose short, descriptive keys to minimize memory usage</li><li>Be consistent with key naming conventions</li><li>Remember that property access via dot notation (<code>obj.prop</code>) and bracket notation (<code>obj[&quot;prop&quot;]</code>) are equivalent</li><li>Keys containing special characters or reserved words must use bracket notation: <code>obj[&quot;special-key&quot;]</code></li></ul><h3 id="memory-usage-optimization">Memory Usage Optimization</h3><p>To optimize dictionary memory usage:</p><ul><li>Delete unused keys to prevent memory leaks</li><li>Use shallow structures when possible</li><li>Consider serialization for large dictionaries not actively used</li><li>Be aware that circular references delay garbage collection until mark-sweep GC runs</li></ul><pre class="prettyprint source"><code>// Circular reference example
let obj1 = {};
let obj2 = {ref: obj1};
obj1.ref = obj2; // Creates a circular reference

// While reference counting won't collect these immediately,
// a mark-sweep GC run will eventually reclaim this memory
// when the objects become unreachable from the root scope
</code></pre><h3 id="performance-patterns">Performance Patterns</h3><h4 id="property-access-optimization">Property Access Optimization</h4><p>When repeatedly accessing the same property in loops, consider caching:</p><pre class="prettyprint source"><code>// Less efficient - repeated property access
for (let i = 0; i &lt; 1000; i++) {
    processValue(config.complexComputedValue);
}

// More efficient - cache the property
let cachedValue = config.complexComputedValue;
for (let i = 0; i &lt; 1000; i++) {
    processValue(cachedValue);
}
</code></pre><h4 id="key-existence-check-performance">Key Existence Check Performance</h4><p>Different methods for checking key existence have varying performance implications:</p><pre class="prettyprint source"><code>// Option 1: Using exists() - most explicit and readable
if (exists(user, &quot;email&quot;)) {
    sendEmail(user.email);
}

// Option 2: Direct property access with null check
if (user.email != null) {
    sendEmail(user.email);
}

// Option 3: Using in operator with keys
if (&quot;email&quot; in keys(user)) {
    sendEmail(user.email);
}
</code></pre><p>Option 1 is typically the most performant as it's specifically designed for this purpose.</p><h3 id="dictionary-implementation-details">Dictionary Implementation Details</h3><p>Understanding internal implementation details can help write more efficient code:</p><ol><li><strong>Initial Capacity</strong>: Dictionaries start with a small capacity and grow as needed</li><li><strong>Load Factor</strong>: When dictionaries reach a certain fullness threshold, they're resized</li><li><strong>Hash Function</strong>: Keys are hashed using a specialized string hashing function</li><li><strong>Collision Resolution</strong>: Ucode typically uses open addressing with linear probing</li><li><strong>Deletion</strong>: When keys are deleted, they're marked as deleted but space isn't reclaimed until rehashing</li><li><strong>Order Preservation</strong>: Unlike many hash table implementations, ucode tracks and maintains insertion order</li></ol><p>These implementation details explain why:</p><ul><li>Iterating over a dictionary with many deleted keys might be slower</li><li>Adding many keys may trigger occasional performance pauses for rehashing</li><li>Key order is consistent and predictable, matching declaration/assignment order</li><li>Dictionaries can be deliberately reordered using <code>sort()</code></li></ul><h2 id="conclusion">Conclusion</h2><p>Dictionaries in ucode provide a powerful and flexible way to organize data by key-value relationships. By understanding their implementation characteristics and following best practices, you can effectively leverage dictionaries for everything from simple configuration storage to complex nested data structures.</p><p>Remember that dictionaries excel at:</p><ul><li>Fast lookups by string key</li><li>Dynamic property addition and removal</li><li>Representing structured data</li><li>Implementing caches and lookup tables</li></ul><p>When working with large dictionaries or performance-critical code, consider the memory usage patterns and optimization techniques described in this article to ensure your code remains efficient and maintainable.</p></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button> <button class="icon-button" id="mobile-toc" data-isopen="false" aria-label="toc"><svg><use xlink:href="#toc-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">ucode Documentation</a><div class="mobile-nav-links"><div class="github-home navbar-item"><a id="" href="https://github.com/jow-/ucode" target="">GitHub Project Page</a></div></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="EGNcbMBDtXXQIS7_KC-yn"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-01-usage.html">Usage</a></div><div class="sidebar-section-children"><a href="tutorial-02-syntax.html">Syntax</a></div><div class="sidebar-section-children"><a href="tutorial-03-memory.html">Memory Management</a></div><div class="sidebar-section-children"><a href="tutorial-04-arrays.html">Working with Arrays</a></div><div class="sidebar-section-children"><a href="tutorial-05-dictionaries.html">Working with Dictionaries</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="pNEJb8uuqCcUZna8YADYC"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-core.html">core</a></div><div class="sidebar-section-children"><a href="module-debug.html">debug</a></div><div class="sidebar-section-children"><a href="module-digest.html">digest</a></div><div class="sidebar-section-children"><a href="module-fs.html">fs</a></div><div class="sidebar-section-children"><a href="module-log.html">log</a></div><div class="sidebar-section-children"><a href="module-math.html">math</a></div><div class="sidebar-section-children"><a href="module-resolv.html">resolv</a></div><div class="sidebar-section-children"><a href="module-socket.html">socket</a></div><div class="sidebar-section-children"><a href="module-struct.html">struct</a></div><div class="sidebar-section-children"><a href="module-uci.html">uci</a></div><div class="sidebar-section-children"><a href="module-uloop.html">uloop</a></div><div class="sidebar-section-children"><a href="module-zlib.html">zlib</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#dark-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div><div class="navbar-right-item toc-item"><button class="icon-button toc" aria-label="open-table-of-contents"><svg><use xlink:href="#toc-icon"></use></svg></button></div></div></div></div><div id="mobile-tocbar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><span class="sidebar-title">Table of Contents</span><div class="toc-contents"></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#mobile-tocbar > .mobile-sidebar-wrapper > .toc-contents",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:(...e)=>{hideMobileMenu(),bringLinkToView(...e)},includeHtml:!0})</script></body></html>